<?php
/**
 * Created by PhpStorm.
 * User: wang
 * Date: 2018/4/28
 * Time: 上午9:27
 */

namespace App\Routes;


use Dingo\Api\Routing\Router as DingoRouter;
use Laravel\Lumen\Routing\Router as LumenRouter;

class MiniProgramApiRoutes extends ApiRoutes
{
    /**
     * @param LumenRouter|DingoRouter $router
     * */
    public function subRoutes($router)
    {
        parent::subRoutes($router); // TODO: Change the autogenerated stub

        $router->get('/login/{code}', ['as' => 'user.login','uses' => 'AuthController@login']);
        $router->get('/app/access', ['as' => 'user.app.access','uses' => 'AuthController@appAccess']);
        $router->post('/register/user', ['as' => 'user.register.user','uses' => 'AuthController@registerUser']);

        $attributes = [];

        if($this->app->environment() !== 'local') {
            $attributes['middleware'] = ['api.auth'];
        }

        $router->group($attributes, function ($router) {

            /** @var DingoRouter $router */
            $router->get('/user/info', ['as' => 'user.info','uses' => 'AuthController@userInfo']);

            $router->post('/save/mobile', ['as' => 'user.save.mobile','uses' => 'AuthController@saveMobile']);


            $router->get('/new/activity', ['as' => 'user.new.activity','uses' => 'ActivityController@newActivity']);
            $router->get('/new/activity/{activityId}/merchandises', ['as' => 'user.new.activity.merchandises','uses' => 'ActivityController@newActivityMerchandises']);


            $router->get('/nearest/store', ['as' => 'user.nearest.store','uses' => 'ShopsController@nearestStore']);
            $router->get('/nearby/stores', ['as' => 'user.nearby.stores','uses' => 'ShopsController@nearbyStores']);
            $router->get('/store/statistics', ['as' => 'user.store.statistics','uses' => 'ShopsController@storeStatistics']);
            $router->get('/store/sell/statistics', ['as' => 'user.store.sell.statistics','uses' => 'ShopsController@storeSellStatistics']);
            $router->get('/search/shop/merchandises/{shopId}', ['as' => 'user.search.shop.merchandises','uses' => 'ShopsController@searchShopMerchandises']);


            $router->get('/categories', ['as' => 'user.categories','uses' => 'CategoriesController@categories']);
            $router->get('/store/{id}/categories', ['as' => 'user.store.categories','uses' => 'CategoriesController@storeCategories']);
            $router->get('/store/stock/statistics', ['as' => 'user.store.stock.statistics','uses' => 'CategoriesController@storeStockStatistics']);
            $router->get('/reserve/search/merchandises', ['as' => 'user.reserve.search.','uses' => 'CategoriesController@reserveSearchMerchandises']);
            $router->put('/store/merchandise/{merchandiseId}/stock', ['as' => 'user.store.merchandise.stock','uses' => 'CategoriesController@storeMerchandiseStock']);
            $router->get('/categories/{id}/merchandises', ['as' => 'user.categories.merchandises','uses' => 'CategoriesController@categoriesMerchandises']);
            $router->get('/store/{id}/category/{categoryId}/merchandises', ['as' => 'user.store.category.merchandise','uses' => 'CategoriesController@storeCategoryMerchandise']);


            $router->get('/user/tickets/{status}', ['as' => 'user.user.tickets','uses' => 'UserController@UserTickets']);
            $router->post('/feed/back/message', ['as' => 'user.feed.back.message','uses' => 'UserController@feedBackMessage']);


            $router->get('/cancel/order/{id}', ['as' => 'user.cancel.order.','uses' => 'OrderController@cancelOrder']);
            $router->get('/confirm/order/{id}', ['as' => 'user.confirm.order.','uses' => 'OrderController@confirmOrder']);
            $router->get('/{status}/orders', ['as' => 'user.orders','uses' => 'OrderController@Orders']);
            $router->post('/create/order', ['as' => 'user.create.order','uses' => 'OrderController@createOrder']);
            $router->get('/again/order/{orderId}', ['as' => 'user.again.order','uses' => 'OrderController@againOrder']);
            $router->get('/store/buffet/orders', ['as' => 'user.store.buffet.orders','uses' => 'OrderController@storeBuffetOrders']);
            $router->get('/store/send/orders', ['as' => 'user.store.send.orders','uses' => 'OrderController@storeSendOrders']);
            $router->get('/store/orders/summary', ['as' => 'user.store.orders.summary','uses' => 'OrderController@storeOrdersSummary']);
            $router->get('/store/purchase/statistics', ['as' => 'user.store.purchase.statistics','uses' => 'PurchaseOrderController@storePurchaseStatistics']);
            $router->get('/store/code/order/merchandise/up', ['as' => 'user.store.code.order.merchandise.up','uses' => 'PurchaseOrderController@storeCodeOrderMerchandiseUp']);


            $router->post('/add/merchandise', ['as' => 'user.add.merchandise','uses' => 'ShoppingCartController@addMerchandise']);
            $router->post('/reduce/merchandise', ['as' => 'user.reduce.merchandise','uses' => 'ShoppingCartController@reduceMerchandise']);
            $router->get('/empty/shop/merchandises/{storeId}', ['as' => 'user.empty.shop.merchandise','uses' => 'ShoppingCartController@emptyMerchandise']);
            $router->get('/empty/activity/merchandises/{activityId}', ['as' => 'user.empty.activity.merchandise','uses' => 'ShoppingCartController@emptyMerchandise']);
            $router->get('/empty/merchandises', ['as' => 'user.empty.merchandise','uses' => 'ShoppingCartController@emptyMerchandise']);
            $router->get('/shoppingcart/shop/merchandises/{storeId}', ['as' => 'user.shoppingcart.shop.merchandises','uses' => 'ShoppingCartController@shoppingCartMerchandises']);
            $router->get('/shoppingcart/activity/merchandises/{activityId}', ['as' => 'user.shoppingcart.activity.merchandises','uses' => 'ShoppingCartController@shoppingCartMerchandises']);
            $router->get('/shoppingcart/merchandises', ['as' => 'user.shoppingcart.merchandises','uses' => 'ShoppingCartController@shoppingCartMerchandises']);
        });

        $router->addRoute(['GET', 'POST'], '/payment/notify', ['as' => 'payment.notify', 'uses' => 'PaymentController@notify']);
    }
}